#!/bin/sh
# $Id: yaz-config.in,v 1.12 2002-03-18 12:22:00 adam Exp $
yazprefix=@prefix@
yaz_echo_cflags=no
yaz_echo_libs=no
yaz_echo_help=no
yaz_echo_tabs=no
yaz_echo_source=yes
yaz_echo_lalibs=no
yaz_echo_comp=no
yaz_src_root=@YAZ_SRC_ROOT@
yaz_build_root=@YAZ_BUILD_ROOT@

yazextralibs="@LIBS@"
YAZVERSION=@VERSION@

usage()
{
	cat <<EOF
Usage: yaz-config [OPTIONS] [LIBRARIES]
Options:
	[--prefix[=DIR]]
	[--version]
	[--libs]
	[--lalibs]
	[--cflags]
	[--tabs]
	[--comp]
Libraries:
	threads
        malloc
        ssl
EOF
	exit $1
}

#if test $# -eq 0; then
#	yaz_echo_help=yes
#fi

while test $# -gt 0; do
  case "$1" in
  -*=*) optarg=`echo "$1" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
  *) optarg= ;;
  esac

  case $1 in
    --prefix=*)
      yazprefix=$optarg
      ;;
    --prefix)
      echo $yazprefix
      exit 0
      ;;
    --version)
      echo $YAZVERSION
      exit 0
      ;;
    --cflags)
      yaz_echo_cflags=yes
      ;;
    --libs)
      yaz_echo_libs=yes
      ;;
    --tabs)
      yaz_echo_tabs=yes
      ;;
    --lalibs)
      yaz_echo_lalibs=yes
      ;;
    --comp)
      yaz_echo_comp=yes
      ;;
    threads)
      lib_thread=yes
      ;;
    malloc)
      lib_malloc=yes
      ;;
    ssl)
      lib_ssl=yes
      ;;
    -*)
      yaz_echo_help=yes
      ;;
  esac
  shift
done

lyaz="-lyaz"

if test "$lib_thread" = "yes" -a -n "@CFLAGSTHREADS@"; then
    yazextralibs="@LIBTHREAD@ $yazextralibs"
    lyaz="-lyazthread $lyaz"
fi 

if test "$lib_malloc" = "yes"; then
    lyaz="-lyazmalloc $lyaz"
fi

if test "$lib_ssl" = "yes" -a -n "@SSL_LIBS@"; then
    yazextralibs="@SSL_LIBS@ $yazextralibs"
    lyaz="-lyazssl $lyaz"
fi

if test "$yaz_echo_source" = "yes"; then
    YAZTAB=${yaz_src_root}/tab
    YAZBIN=${yaz_build_root}/bin
    YAZLIB="-L${yaz_build_root}/lib/.libs $lyaz $yazextralibs"
    YAZLALIB="${yaz_build_root}/lib/libyaz.la $yazextralibs"
    if test "$lib_ssl" = "yes" -a -n "$SSL_LIBS@"; then
        YAZLALIB="${yaz_build_root}/lib/libyazssl.la"
    fi
    if test "$lib_thread" = "yes" -a -n "@CFLAGSTHREADS@"; then
        YAZLALIB="${yaz_build_root}/lib/libyazthread.la $YAZLALIB"
    fi
    if test "$lib_malloc" = "yes"; then
        YAZLALIB="${yaz_build_root}/lib/libyazmalloc.la $YAZLALIB"
    fi
    YAZINC="-I${yaz_src_root}/include"
    YAZCOMP=${yaz_src_root}/util/yaz-comp
else
    YAZTAB=${yazprefix}/share/yaz/tab
    YAZBIN=${yazprefix}/bin
    YAZCOMP=${yazprefix}/bin/yaz-comp

    if test "$yazprefix" = "/usr"; then
	YAZLIB="$lyaz $yazextralibs"
    else
	YAZLIB="-L$yazprefix/lib $lyaz $yazextralibs"
    fi
    YAZLALIB=$YAZLIB
    if test "$yazprefix" = "/usr"; then
	YAZINC=
    else
	YAZINC=-I$yazprefix/include
    fi
fi

if test "$lib_thread" = "yes"; then
    YAZINC="$YAZINC @CFLAGSTHREADS@"
fi

if test "$lib_ssl" = "yes"; then
    YAZINC="$YAZINC @SSL_CFLAGS@"
fi

if test "$yaz_echo_help" = "yes"; then
	usage 1 1>&2
fi
if test "$yaz_echo_cflags" = "yes"; then
	echo $YAZINC
fi
if test "$yaz_echo_libs" = "yes"; then
	echo $YAZLIB
fi
if test "$yaz_echo_tabs" = "yes"; then
	echo $YAZTAB
fi
if test "$yaz_echo_lalibs" = "yes"; then
	echo $YAZLALIB
fi
if test "$yaz_echo_comp" = "yes"; then
	echo $YAZCOMP
fi
